<%- include('../partials/admin/header.ejs') %>

<div class="container-fluid">
    <div class="row">
        

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Sales Report</h1>
            </div>

            <!-- Filters -->
            <div class="card mb-4">
                <div class="card-body">
                    <form action="/admin/salesReport" method="GET" class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">Quick Filters</label>
                            <select name="period" class="form-select" onchange="this.form.submit()">
                                <option value="">Custom Range</option>
                                <option value="daily" <%= period === 'daily' ? 'selected' : '' %>>Today</option>
                                <option value="weekly" <%= period === 'weekly' ? 'selected' : '' %>>Last 7 Days</option>
                                <option value="monthly" <%= period === 'monthly' ? 'selected' : '' %>>Last 30 Days</option>
                                <option value="yearly" <%= period === 'yearly' ? 'selected' : '' %>>Last Year</option>
                            </select>
                        </div>
                        
                        <div class="col-md-3">
                            <label class="form-label">Start Date</label>
                            <input type="date" name="startDate" class="form-control" value="<%= startDate %>">
                        </div>
                        
                        <div class="col-md-3">
                            <label class="form-label">End Date</label>
                            <input type="date" name="endDate" class="form-control" value="<%= endDate %>">
                        </div>
                        
                        <div class="col-md-3 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary me-2">Filter</button>
                            <div class="dropdown">
                                <button class="btn btn-secondary dropdown-toggle" type="button" id="downloadDropdown" data-bs-toggle="dropdown">
                                    Download
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="/salesReport/download?format=pdf&period=<%= period %>&startDate=<%= startDate %>&endDate=<%= endDate %>">PDF</a></li>
                                    <li><a class="dropdown-item" href="/salesReport/download?format=csv&period=<%= period %>&startDate=<%= startDate %>&endDate=<%= endDate %>">CSV</a></li>
                                </ul>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <h5 class="card-title">Total Orders</h5>
                            <h2 class="card-text"><%= totalOrders %></h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <h5 class="card-title">Total Revenue</h5>
                            <h2 class="card-text">₹<%= totalRevenue.toFixed(2) %></h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <h5 class="card-title">Total Discount</h5>
                            <h2 class="card-text">₹<%= totalDiscount.toFixed(2) %></h2>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-container">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Date</th>
                                        <th>Customer</th>
                                        <th>Discount</th>
                                        <th>Total Amount</th>
                                        <th>Status</th>
                                        <th>Payment Method</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% orders.forEach(order => { %>
                                        <tr>
                                            <td><%= order._id %></td>
                                            <td><%= moment(order.orderDate).format('YYYY-MM-DD HH:mm:ss') %></td>
                                            <td><%= order.address.fullName %></td>
                                            <td>₹<%= (order.savings || 0).toFixed(2) %></td>
                                            <td>₹<%= order.totalAmount.toFixed(2) %></td>
                                            <td>
                                                <span class="badge bg-<%= order.status === 'Delivered' ? 'success' : 
                                                                     order.status === 'Pending' ? 'warning' : 
                                                                     order.status === 'Cancelled' ? 'danger' : 'primary' %>">
                                                    <%= order.status %>
                                                </span>
                                            </td>
                                            <td><%= order.paymentMethod %></td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<style>
    body {
        font-family: 'Arial', sans-serif;
        background-color: #f8f9fa;
        color: #333;
        overflow-x: hidden;
    }

    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        border: none;
        margin-bottom: 1rem;
    }
    
    .table th {
        background-color: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
    }
    
    .dropdown-toggle::after {
        display: none;
    }
    
    .table-container {
        max-height: 400px;
        overflow-y: auto;
        margin-top: 20px;
        scrollbar-width: thin;
        scrollbar-color: #dee2e6 #f0f0f0;
    }

    .table-container::-webkit-scrollbar {
        width: 8px;
    }

    .table-container::-webkit-scrollbar-track {
        background: #f0f0f0;
        border-radius: 4px;
    }

    .table-container::-webkit-scrollbar-thumb {
        background: #e91e63;
        border-radius: 4px;
    }

    .table-container::-webkit-scrollbar-thumb:hover {
        background: #d81557;
    }

    .table thead {
        position: sticky;
        top: 0;
        z-index: 1;
        background-color: #6d214f;
        color: #fff;
    }

    .table tbody tr:hover {
        background-color: #f8f9fa;
        transition: background-color 0.2s ease;
    }

    @media (max-width: 768px) {
        .col-md-3 {
            margin-bottom: 1rem;
        }
        
        .card-body {
            padding: 1rem;
        }

        .table-container {
            max-height: 350px;
        }
    }
    
    @media (min-width: 576px) {
        .ms-sm-auto {
            width: 100% !important;
        }
    }

    @media (max-width: 576px) {
        .table-container {
            max-height: 300px;
        }
    }
</style>

<%- include('../partials/admin/footer.ejs') %>
