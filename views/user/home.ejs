<%-include("../../views/partials/user/header")%>
    <style>
      .book-card{
        align-self: st;
      }

      .item{
        height: 9rem;
      }
    </style>
    <section id="limited-offer" class="padding-large"
      style="background-image: url(images/banner-image-bg-1.jpg); background-size: cover; background-repeat: no-repeat; background-position: center; height: 800px;">
      <div class="container">
        <div class="row d-flex align-items-center">
          <div class="col-md-6 text-center">
            <div class="image-holder">
              <img src="images/banner-image3.png" class="img-fluid" alt="banner">
            </div>
          </div>
          <div class="col-md-5 offset-md-1 mt-5 mt-md-0 text-center text-md-start">
            <h2>30% Discount on all items. Hurry Up !!!</h2>
            <div id="countdown-clock" class="text-dark d-flex align-items-center my-3">
              <div class="time d-grid pe-3">
                <span class="days fs-1 fw-normal"></span>
                <small>Days</small>
              </div>
              <span class="fs-1 text-primary">:</span>
              <div class="time d-grid pe-3 ps-3">
                <span class="hours fs-1 fw-normal"></span>
                <small>Hrs</small>
              </div>
              <span class="fs-1 text-primary">:</span>
              <div class="time d-grid pe-3 ps-3">
                <span class="minutes fs-1 fw-normal"></span>
                <small>Min</small>
              </div>
              <span class="fs-1 text-primary">:</span>
              <div class="time d-grid ps-3">
                <span class="seconds fs-1 fw-normal"></span>
                <small>Sec</small>
              </div>
            </div>
            <a href="/user/shop/:page" class="btn mt-3">Shop Collection</a>
          </div>
        </div>
      </div>
      </div>
    </section>

    <section id="best-selling-items" class="position-relative padding-large ">
      <div class="container">
        <div class="section-title d-md-flex justify-content-between align-items-center mb-4">
          <h3 class="d-flex align-items-center">Best selling Books</h3>
          <a href="/user/shop/:page" class="btn">View All</a>
        </div>
        <div class="position-absolute top-50 end-0 pe-0 pe-xxl-5 me-0 me-xxl-5 swiper-next product-slider-button-next">
          <svg class="chevron-forward-circle d-flex justify-content-center align-items-center p-2" width="80" height="80">
            <use xlink:href="#alt-arrow-right-outline"></use>
          </svg>
        </div>
        <div class="position-absolute top-50 start-0 ps-0 ps-xxl-5 ms-0 ms-xxl-5 swiper-prev product-slider-button-prev">
          <svg class="chevron-back-circle d-flex justify-content-center align-items-center p-2" width="80" height="80">
            <use xlink:href="#alt-arrow-left-outline"></use>
          </svg>
        </div>
        <div class="swiper product-swiper">
          <div class="swiper-wrapper">
            <!-- books -->
             <% for(let i = 0; i < book.length; i++){ %>
            <div class="swiper-slide book-card">
              <div class="card position-relative p-4 border rounded-3">
                <div class="position-absolute">
                  <p class="bg-primary py-1 px-3 fs-6 text-white rounded-2"><%= book[i].totalDiscount%>%</p>
                </div>
                <a href="/productDetails/?id=<%=book[i]._id%>"><img src="uploads/<%= book[i].productImage[0] %>" class="img-fluid shadow-sm" alt="product item"></a>
                <h6 class="mt-4 mb-0 fw-bold"><a href="index.html"><%= book[i].productName%></a></h6> 
                <div class="review-content">


                  <div class="rating text-warning d-flex align-items-center">
                    <svg class="star star-fill">
                      <use xlink:href="#star-fill"></use>
                    </svg>
                    <svg class="star star-fill">
                      <use xlink:href="#star-fill"></use>
                    </svg>
                    <svg class="star star-fill">
                      <use xlink:href="#star-fill"></use>
                    </svg>
                    <svg class="star star-fill">
                      <use xlink:href="#star-fill"></use>
                    </svg>
                    <svg class="star star-fill">
                      <use xlink:href="#star-fill"></use>
                    </svg>
                  </div>
                  <div class="row">
                    <p class="my-2 me-2 fs-6 text-black-50 text-truncate"><%= book[i].description %></p>
                  </div> 
                </div>
                <span class="price text-primary fw-bold mb-2 fs-5">₹<strike><%= book[i].regularPrice %></strike></span>
                <span class="price text-primary fw-bold mb-2 fs-5">₹<%= book[i].finalPrice %></span>
                <div class="card-concern position-absolute start-0 end-0 d-flex gap-2">
                  <!-- Add to Cart Button -->
                  <button type="button" onclick="addToCart('<%=book[i]._id%>')" class="btn btn-dark" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Add to Cart">
                    <svg class="cart">
                      <use xlink:href="#cart"></use>
                    </svg>
                  </button>
                
                  <!-- Add to Wishlist Button -->
                  <button type="button" onclick="addToWishlist('<%=book[i]._id%>')" class="btn btn-dark" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Add to Wishlist">
                    <svg class="wishlist">
                      <use xlink:href="#heart"></use>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            <% } %>

          </div>
        </div>
      </div>
    </section>

    <section id="items-listing" class="padding-large">
      <div class="container">
        <div class="row">
          <h3 class="d-flex align-items-center mb-4">Categories</h3>
          <% for(let i=0;i<cats.length;i++) { %>
          <div class="col-md-6 mb-4 mb-lg-0 col-lg-3">
            <div class="featured border rounded-3 p-4 position-relative">
              <div class="position-absolute" style="top: 10px; right: 10px; z-index: 2;">
                <% if (cats[i].offer && cats[i].offer > 0) { %>
                  <p class="bg-primary py-1 px-3 fs-6 text-white rounded-2 mb-0"><%= cats[i].offer %>% OFF</p>
                <% } %>
              </div>
              <div class="section-title overflow-hidden mb-5 mt-2">
                <h3 class="d-flex flex-column mb-0"><%=cats[i].name%></h3>
              </div>
              <div class="items-lists" >
                <% for(let j=0;j<cats[i].topProducts.length;j++) { %>
                <div class="item d-flex">
                  <img src="uploads/<%= cats[i].topProducts[j].productImage[0] %>" class="img-fluid shadow-sm" alt="product item">
                  <div class="item-content ms-3">
                    <h6 class="mb-0 fw-bold"><a href="/productDetails/?id=<%=cats[i].topProducts[j]._id%>"><%=cats[i].topProducts[j].productName%></a></h6>
                    <div class="review-content d-flex">
                      <p class="my-2 me-2 fs-6 text-black-50"><%=cats[i].topProducts[j].description %></p>

                      <div class="rating text-warning d-flex align-items-center">
                        <svg class="star star-fill">
                          <use xlink:href="#star-fill"></use>
                        </svg>
                        <svg class="star star-fill">
                          <use xlink:href="#star-fill"></use>
                        </svg>
                        <svg class="star star-fill">
                          <use xlink:href="#star-fill"></use>
                        </svg>
                        <svg class="star star-fill">
                          <use xlink:href="#star-fill"></use>
                        </svg>
                        <svg class="star star-fill">
                          <use xlink:href="#star-fill"></use>
                        </svg>
                      </div>
                    </div>
                    <span class="price text-primary fw-bold mb-2 fs-5">₹<Strike><%=cats[i].topProducts[j].regularPrice %></Strike></span>
                    <span class="price text-primary fw-bold mb-2 fs-5">₹<%=cats[i].topProducts[j].salePrice %></span>
                  </div>
                </div>
                <hr>
                <%}%> 
              </div>
            </div>
          </div>
          <%}%>
        </div>
      </div>
    </section>
    <section id="company-services" class="padding-large pb-0">
      <div class="container">
        <div class="row">
          <div class="col-lg-3 col-md-6 pb-3 pb-lg-0">
            <div class="icon-box d-flex">
              <div class="icon-box-icon pe-3 pb-3">
                <svg class="cart-outline">
                  <use xlink:href="#cart-outline" />
                </svg>
              </div>
              <div class="icon-box-content">
                <h4 class="card-title mb-1 text-capitalize text-dark">Free delivery</h4>
                <p>Booklove offers free delivery on all your favorite books!</p>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 pb-3 pb-lg-0">
            <div class="icon-box d-flex">
              <div class="icon-box-icon pe-3 pb-3">
                <svg class="quality">
                  <use xlink:href="#quality" />
                </svg>
              </div>
              <div class="icon-box-content">
                <h4 class="card-title mb-1 text-capitalize text-dark">Quality guarantee</h4>
                <p>Booklove ensures quality guarantee for every book you purchase!</p>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 pb-3 pb-lg-0">
            <div class="icon-box d-flex">
              <div class="icon-box-icon pe-3 pb-3">
                <svg class="price-tag">
                  <use xlink:href="#price-tag" />
                </svg>
              </div>
              <div class="icon-box-content">
                <h4 class="card-title mb-1 text-capitalize text-dark">Daily offers</h4>
                <p>Booklove brings you exciting daily offer on a wide range of books!</p>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6 pb-3 pb-lg-0">
            <div class="icon-box d-flex">
              <div class="icon-box-icon pe-3 pb-3">
                <svg class="shield-plus">
                  <use xlink:href="#shield-plus" />
                </svg>
              </div>
              <div class="icon-box-content">
                <h4 class="card-title mb-1 text-capitalize text-dark">100% secure payment</h4>
                <p>Booklove guarantee 100% secure payment for a safe shopping experience!</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  async function addToWishlist(productId) {
    try {
        const response = await fetch('/addToWishlist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ productId: productId })
        });
        
        const data = await response.json();
        
        if (data.success) {
            Swal.fire({
                position: "center",
                icon: "success",
                title: data.message || "Added to wishlist!",
                showConfirmButton: true,
                timer: 2000
            });
        } else {
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: data.message || "Failed to add to wishlist",
            });
        }
    } catch (error) {
        console.error('Error:', error);
        Swal.fire({
            icon: "error",
            title: "Oops...",
            text: "Something went wrong!",
        });
    }
}

    async function addToCart(productId) {
        try {
            const response = await fetch('/addToCart', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: productId })
            });
            const data = await response.json();
            if (data.success) {
                // Update cart count if available
                if (data.cartCount !== undefined) {
                    const cartCountElements = document.querySelectorAll('.cart-count');
                    cartCountElements.forEach(element => {
                        const formattedCount = data.cartCount.toString().padStart(2, '0');
                        element.textContent = `(${formattedCount})`;
                    });
                }
                Swal.fire({
                    position: "center",
                    icon: "success",
                    title: data.message,
                    showConfirmButton: true,
                    timer: 2000
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: data.message,
                });
            }
        } catch (error) {
            console.error('Error:', error);
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Something went wrong!",
            });
        }
    }
</script>
<%-include("../../views/partials/user/footer")%>